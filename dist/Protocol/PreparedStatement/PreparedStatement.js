var t,e;import{DateFormat as s}from"../../Formats/DateFormat.js";import{DateTimeFormat as f}from"../../Formats/DateTimeFormat.js";import{TimeFormat as u}from"../../Formats/TimeFormat.js";import{FieldTypes as r}from"../Enumerations.js";import{createInt16LE as o,createInt32LE as n,createInt64LE as p,createInt8 as h,createUInt16LE as i,createUInt32LE as m,createUInt64LE as a,createUInt8 as I,generateNullBitmap as N,toDatetimeEncoded as T,toStringEncoded as c,toTimeEncoded as l}from"../../Utils/BufferUtil.js";function E(e,s=!0){return Buffer.from([e,s?t.UNSIGNED:0])}(e=t||(t={}))[e.UNSIGNED=128]="UNSIGNED";export function createExecutePacket(t,e){let B=Buffer.allocUnsafe(10);B.writeInt8(23),B.writeInt32LE(t.statementId,1),B.writeInt8(0,5),B.writeInt32LE(1,6);let g=[],D=[];for(let N=0;N<t.parametersCount;N++){let t=e[N];null==t?g.push(E(r.NULL)):"number"==typeof t?Number.isSafeInteger(t)?t>4294967295?(D.push(a(BigInt(t))),g.push(E(r.BIGINT))):t>65535?(D.push(m(t)),g.push(E(r.INT))):t>255?(D.push(i(t)),g.push(E(r.SMALLINT))):t>=0?(D.push(I(t)),g.push(E(r.TINYINT))):t>=-127?(D.push(h(t)),g.push(E(r.TINYINT,!1))):t>=-32767?(D.push(o(t)),g.push(E(r.SMALLINT,!1))):t>=-2147483647?(D.push(n(t)),g.push(E(r.INT,!1))):(D.push(p(BigInt(t))),g.push(E(r.BIGINT,!1))):(D.push(c(t.toString())),g.push(E(r.DECIMAL))):"string"==typeof t?(D.push(c(t)),g.push(E(r.VARCHAR))):"bigint"==typeof t?t>=-0x7fffffffffffffffn&&t<=0xffffffffffffffffn?(D.push(t>=0?a(t):p(t)),g.push(E(r.BIGINT,t>=0))):(D.push(c(t.toString())),g.push(E(r.DECIMAL))):t instanceof Date?(D.push(T(t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),1e3*t.getMilliseconds())),g.push(E(r.DATETIME))):t instanceof f?(D.push(T(t.date.year,t.date.month,t.date.day,t.time.hours,t.time.minutes,t.time.seconds,t.time.ms)),g.push(E(r.DATETIME))):t instanceof s?(D.push(T(t.year,t.month,t.day)),g.push(E(r.DATETIME))):t instanceof u?(D.push(l(t.hours,t.minutes,t.seconds,t.ms)),g.push(E(r.TIME))):"boolean"==typeof t?(D.push(Buffer.from([Number(t)])),g.push(E(r.TINYINT))):(D.push(c(t)),g.push(E(r.BLOB)))}return Buffer.concat([B,N(e),Buffer.from([1]),...g,...D])}export function createClosePacket(t){return Buffer.concat([Buffer.from([25]),m(t)])}